<%- @pledge = @project.pledges.build if @pledge.nil? -%>
<%- @rewards = @project.rewards -%>
<%- @requested_rewards = @pledge.requested_rewards.build -%>
  <div class="page-header center">
    <h2 class="text-center"><%= @project.title %></h2>
    <h5 class="text-center">By <%= @project.owner.name %></h5>
  </div>
<div class="row">
<% if @pledge.errors.any? %>
  <div id="error_explanation" class="alert alert-error">
    <h2><%= pluralize(@pledge.errors.count, "error") %> prohibited this pledge from being saved:</h2>

    <ul>
    <% @pledge.errors.full_messages.each do |msg| %>
      <li><%= msg %></li>
    <% end %>
    </ul>
  </div>
<% end %>
  <div id="new-message" class="span8 offset1">
    <%= form_for @pledge, url: create_pledge_project_path(@project), html: { class: 'form-horizontal' } do |pledge| %>
      <div class="control-group">
        <%= pledge.label :amount, "Amount(in USD)", :class => 'control-label' %>
        <div class="controls">
          <%= pledge.text_field :amount, :class => 'text_field' %>
          <p class="help-block">Enter the amount(in US Dollars) you want to pledge for this project</p>
        </div>
      </div>
      <div class="control-group">
        <%= label_tag :payment_mode, "Payment Mode", :class => 'control-label' %>
        <div class="controls">
          <label class="radio">
            <%= radio_button_tag :payment_mode, "Paypal" %>
            Paypal
          </label>
          <label class="radio">
            <%= radio_button_tag :payment_mode, "Stripe" %>
            Credit Card
          </label>
        </div>
      </div>
      <div class="control-group">
        <%= label_tag :rewards, "Choose Rewards", :class => 'control-label' %>
        <div id="rewards" class="controls">

          <% if !@rewards.empty? %> 
            <div class="highlight">
              <% @rewards.each_with_index do |reward, index| %>
                <label class='checkbox' style="width:300px;display: inline-block;">
                  <input type='checkbox' id='reward_<%= reward.id %>' name='rewards[<%= index %>][id]' value="<%= reward.id %>" />
                  <div class="reward-info">
                    <h5>Reward #<%= index + 1 %></h5>
                    <div class="reward-details">
                      <%= render partial: 'rewards/show_fields', locals: { :reward => reward } %>
                    </div>
                  </div>
                </label>
                <div class="reward-quantity" style="width: 100px;display: inline-block;">
                  <input type='text' name='rewards[<%= index %>][quantity]' id='quantity_<%= reward.id %>' class='input-small'/>
                </div>
              <% end %>
            </div>
          <% end %>

        </div>
      </div>

      <%= pledge.submit "Pledge" %>
    <% end %>
  </div>
</div>